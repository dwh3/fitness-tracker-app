<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
  />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="theme-color" content="#4F46E5" />
  <title>FitTrack</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="images/icon-192.png" />

  <!-- CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" />
  <link rel="stylesheet" href="css/styles.css" />

  <style>
    /* tiny utilities kept inline */
    .btn-text {
      background: none;
      border: none;
      color: var(--primary);
      font-weight: 600;
      font-size: 14px;
      padding: 8px 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .btn-text:active { opacity: 0.7; }
    .search-container { position: relative; margin-bottom: 12px; }
    .search-icon {
      position: absolute; left: 14px; top: 50%; transform: translateY(-50%);
      color: var(--gray-400); pointer-events: none;
    }
    .search-input {
      width: 100%; padding: 12px 14px 12px 40px; border: 1px solid var(--gray-300);
      border-radius: 12px; font-size: 16px; background: var(--white);
    }
    .search-input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(79,70,229,0.1); }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Header -->
    <header class="app-header">
      <div class="header-content">
        <h1 class="header-title" id="pageTitle">Home</h1>
        <button class="btn-icon" onclick="showSettings()">
          <i class="bi bi-person-circle"></i>
        </button>
      </div>
    </header>

    <!-- Main content -->
    <main class="app-content">
      <!-- HOME -->
      <section id="home" class="page active">
        <!-- Today ring -->
        <div class="progress-circle-container">
          <svg class="progress-circle" viewBox="0 0 200 200">
            <circle cx="100" cy="100" r="90" class="progress-circle-bg"></circle>
            <circle cx="100" cy="100" r="90" class="progress-circle-fill" id="progressCircle"></circle>
          </svg>
          <div class="progress-circle-content">
            <div class="ring-big" id="ringValue">0</div>
            <div class="ring-label" id="ringLabel">g protein today</div>
            <div class="ring-goal" id="ringGoal">of 160 goal</div>
          </div>
        </div>

        <!-- Quick stats -->
        <div class="stats-row">
          <div class="stat-card">
            <div class="stat-icon"><i class="bi bi-bar-chart"></i></div>
            <div class="stat-value" id="setsToday">0</div>
            <div class="stat-label">Sets Today</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon"><i class="bi bi-fire"></i></div>
            <div class="stat-value" id="calsToday">0</div>
            <div class="stat-label">Calories Today</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon"><i class="bi bi-graph-down"></i></div>
            <div class="stat-value" id="lastWeight">--</div>
            <div class="stat-label">Last Weight</div>
          </div>
        </div>

        <!-- Quick actions -->
        <div class="quick-actions">
          <button class="action-btn primary" onclick="goToExerciseLog()">
            <i class="bi bi-plus-square"></i>
            <span>Log Exercise</span>
          </button>
          <button class="action-btn" onclick="showDietModal()">
            <i class="bi bi-egg-fried"></i>
            <span>Log Intake</span>
          </button>
          <button class="action-btn" onclick="showWeightModal()">
            <i class="bi bi-scale"></i>
            <span>Log Weight</span>
          </button>
        </div>

        <div class="section-card">
          <h3 class="section-title">Recent Exercise</h3>
          <div id="recentActivity" class="activity-list"></div>
        </div>
      </section>

      <!-- EXERCISE -->
      <section id="exercise" class="page">
        <div class="subtabs" id="exerciseSubtabs">
          <button class="subtab-btn active" onclick="switchSubtab('exercise','log', this)">Log</button>
          <button class="subtab-btn" onclick="switchSubtab('exercise','progress', this)">Progress</button>
        </div>

        <!-- Log subtab -->
        <div class="subtab-panel" data-section="exercise" data-subtab="log">
          <!-- Active workout banner (shows if a workout is in progress) -->
          <div id="activeWorkoutBanner" class="active-banner">
            <div>
              <div class="title">Active Workout</div>
              <div class="meta" id="activeWorkoutBannerMeta"></div>
            </div>
            <div>
              <button class="btn-text" onclick="resumeActiveWorkout()"><i class="bi bi-play-circle"></i> Resume</button>
              <button class="btn-text" onclick="discardActiveWorkout()"><i class="bi bi-x-circle"></i> Discard</button>
            </div>
          </div>

          <!-- Templates -->
          <div class="section-card">
            <div class="section-title" style="display:flex;justify-content:space-between;align-items:center;">
              <span>Templates</span>
              <button class="btn-text" onclick="showTemplateModal()">
                <i class="bi bi-plus-circle"></i> New template
              </button>
            </div>
            <div id="templatesList"></div>
          </div>

          <!-- Today's Session -->
          <div class="section-card">
            <div class="section-title" style="display:flex;justify-content:space-between;align-items:center;">
              <span>Today's Session</span>
              <button class="btn-text" onclick="showExerciseModal()">
                <i class="bi bi-plus-circle"></i> Add exercise
              </button>
            </div>
            <div id="sessionList"></div>
          </div>
        </div>

        <!-- Progress subtab -->
        <div class="subtab-panel hidden" data-section="exercise" data-subtab="progress">
          <div class="section-card">
            <h3 class="section-title">Weekly Sets (last 4 weeks)</h3>
            <div class="chart-fixed">
              <canvas id="setsChart"></canvas>
            </div>
          </div>
          <div class="stats-grid" id="exerciseSummaryGrid"></div>
        </div>
      </section>

      <!-- DIET -->
      <section id="diet" class="page">
        <div class="subtabs" id="dietSubtabs">
          <button class="subtab-btn active" onclick="switchSubtab('diet','log', this)">Log</button>
          <button class="subtab-btn" onclick="switchSubtab('diet','progress', this)">Progress</button>
        </div>

        <!-- Log subtab -->
        <div class="subtab-panel" data-section="diet" data-subtab="log">
          <div class="section-card">
            <div class="section-title" style="display:flex;justify-content:space-between;align-items:center;">
              <span>Today's Intake</span>
              <button class="btn-text" onclick="showDietModal()">
                <i class="bi bi-plus-circle"></i> Add intake
              </button>
            </div>
            <div class="stats-row">
              <div class="stat-card">
                <div class="stat-value" id="todayCals">0</div>
                <div class="stat-label">Calories</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="todayProtein">0</div>
                <div class="stat-label">Protein (g)</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="todayEntries">0</div>
                <div class="stat-label">Entries</div>
              </div>
            </div>
            <div id="todayIntakeList" class="activity-list"></div>
          </div>

          <div class="section-card">
            <h3 class="section-title">Last 7 Days</h3>
            <div id="dietHistory" class="mini-table"></div>
          </div>
        </div>

        <!-- Progress subtab -->
        <div class="subtab-panel hidden" data-section="diet" data-subtab="progress">
          <div class="section-card">
            <h3 class="section-title">Weight Tracking</h3>
            <div class="chart-fixed">
              <canvas id="weightChart"></canvas>
            </div>
            <button class="btn-text" onclick="showWeightModal()">
              <i class="bi bi-plus-circle"></i> Log weight
            </button>
          </div>

          <div class="stats-grid">
            <div class="stat-box">
              <div class="stat-box-value" id="avgCals7d">0</div>
              <div class="stat-box-label">Avg Cals (7d)</div>
            </div>
            <div class="stat-box">
              <div class="stat-box-value" id="weightDelta7d">—</div>
              <div class="stat-box-label">Weight Δ (7d)</div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Bottom navigation -->
    <nav class="bottom-nav">
      <button class="nav-item active" onclick="navigateTo('home')">
        <i class="bi bi-house-fill"></i>
        <span>Home</span>
      </button>
      <button class="nav-item" onclick="navigateTo('exercise')">
        <i class="bi bi-dumbbell"></i>
        <span>Exercise</span>
      </button>
      <button class="nav-item" onclick="navigateTo('diet')">
        <i class="bi bi-egg-fried"></i>
        <span>Diet</span>
      </button>
    </nav>
  </div>

  <!-- Modals -->

  <!-- Settings Modal -->
  <div class="modal-overlay" id="settingsModal" onclick="closeModal(event)">
    <div class="modal-sheet">
      <div class="modal-header">
        <h3>Profile Settings</h3>
        <button class="btn-close" onclick="closeSettings()">×</button>
      </div>
      <div class="modal-body">
        <form id="profileForm">
          <div class="form-group">
            <label>Name</label>
            <input type="text" class="form-input" id="userName" />
          </div>
          <div class="form-group">
            <label>Daily Calorie Goal</label>
            <input type="number" class="form-input" id="calorieGoal" value="2200" />
          </div>
          <div class="form-group">
            <label>Daily Protein Goal (g)</label>
            <input type="number" class="form-input" id="proteinGoal" value="160" />
          </div>

          <div class="form-group">
            <label>Default Rest — Compound (sec)</label>
            <input type="number" class="form-input" id="defRestCompound" min="30" max="600" step="5" value="150" />
          </div>
          <div class="form-group">
            <label>Default Rest — Accessory (sec)</label>
            <input type="number" class="form-input" id="defRestAccessory" min="30" max="600" step="5" value="90" />
          </div>
          <div class="form-group">
            <label style="display:flex;align-items:center;gap:8px;">
              <input type="checkbox" id="restAutoAdjust" />
              Auto‑adjust rest by intensity (heavier sets get more rest)
            </label>
          </div>

          <button type="submit" class="btn-primary-full">Save Settings</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Exercise Picker Modal -->
  <div class="modal-overlay" id="exerciseModal" onclick="closeModal(event)">
    <div class="modal-sheet">
      <div class="modal-header">
        <h3>Add Exercise</h3>
        <button class="btn-close" onclick="closeExerciseModal()">×</button>
      </div>
      <div class="modal-body">
        <div class="search-container">
          <i class="bi bi-search search-icon"></i>
          <input type="search" class="search-input" placeholder="Search exercises..." id="exerciseSearch" />
        </div>
        <div id="exerciseList" class="workouts-list"></div>
      </div>
    </div>
  </div>

  <!-- Template Builder Modal -->
  <div class="modal-overlay" id="templateModal" onclick="closeModal(event)">
    <div class="modal-sheet">
      <div class="modal-header">
        <h3 id="templateModalTitle">New Template</h3>
        <button class="btn-close" onclick="closeTemplateModal()">×</button>
      </div>
      <div class="modal-body">
        <form id="templateForm">
          <div class="form-group">
            <label>Template Name</label>
            <input type="text" class="form-input" id="templateName" required placeholder="e.g., Push Day August 2025" />
          </div>
          <div class="form-group">
            <label>Notes (optional)</label>
            <input type="text" class="form-input" id="templateNotes" placeholder="e.g., Focus on progressive overload" />
          </div>

          <div class="form-group">
            <label>Add Exercises</label>
            <div class="search-container">
              <i class="bi bi-search search-icon"></i>
              <input type="search" class="search-input" id="templateExerciseSearch" placeholder="Search exercises..." />
            </div>
            <div id="templateExerciseResults" class="workouts-list"></div>
          </div>

          <div class="form-group">
            <label>Selected Exercises</label>
            <div id="templateItems"></div>
          </div>

          <button id="saveTemplateBtn" type="submit" class="btn-primary-full">Save Template</button>
          <button type="button" class="btn-secondary-full" style="margin-top: 10px;" onclick="closeTemplateModal()">Cancel</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Active Workout Modal -->
  <div class="modal-overlay" id="activeWorkoutModal" onclick="closeModal(event)">
    <div class="modal-sheet">
      <div class="modal-header">
        <h3 id="activeWorkoutTitle">Active Workout</h3>
        <button class="btn-close" type="button" onclick="closeActiveWorkoutModal()">×</button>
      </div>
      <div class="modal-body">
        <div id="activeWorkoutContent"></div>
        <div class="active-actions">
          <button type="button" class="btn-danger-full" onclick="discardActiveWorkout()">Discard Active Workout</button>
          <button type="button" class="btn-primary-full" onclick="finishActiveWorkout()">Finish Workout</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Diet Intake Modal -->
  <div class="modal-overlay" id="dietModal" onclick="closeModal(event)">
    <div class="modal-sheet">
      <div class="modal-header">
        <h3>Add Intake</h3>
        <button class="btn-close" onclick="closeDietModal()">×</button>
      </div>
      <div class="modal-body">
        <form id="dietForm">
          <div class="form-group">
            <label>Date</label>
            <input type="date" class="form-input" id="dietDate" required />
          </div>
          <div class="form-group">
            <label>Calories</label>
            <input type="number" class="form-input" id="dietCals" required />
          </div>
          <div class="form-group">
            <label>Protein (g)</label>
            <input type="number" class="form-input" id="dietProtein" />
          </div>
          <div class="form-group">
            <label>Carbs (g)</label>
            <input type="number" class="form-input" id="dietCarbs" />
          </div>
          <div class="form-group">
            <label>Fat (g)</label>
            <input type="number" class="form-input" id="dietFat" />
          </div>
          <button type="submit" class="btn-primary-full">Save</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Weight Modal -->
  <div class="modal-overlay" id="weightModal" onclick="closeModal(event)">
    <div class="modal-sheet">
      <div class="modal-header">
        <h3>Log Weight</h3>
        <button class="btn-close" onclick="closeWeightModal()">×</button>
      </div>
      <div class="modal-body">
        <form id="weightForm">
          <div class="form-group">
            <label>Weight (lbs)</label>
            <input type="number" class="form-input" id="weightInput" step="0.1" required />
          </div>
          <div class="form-group">
            <label>Date</label>
            <input type="date" class="form-input" id="dateInput" required />
          </div>
          <button type="submit" class="btn-primary-full">Log Weight</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <!-- JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
